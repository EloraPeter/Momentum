<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Skill tracking and personal growth dashboard">
    <meta name="theme-color" content="#2563EB">
    <title>Momentum</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="images/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
</head>
<body class="min-h-screen flex flex-col">
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">Loading...</div>
    </div>
    
    <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="flex items-center text-xl sm:text-2xl font-bold dark:text-white">
                <img src="images/logo2.png" alt="Momentum logo" class="mr-2"> Momentum
            </h1>
            <button class="md:hidden text-2xl" onclick="toggleSidebar()">‚ò∞</button>
            <nav id="nav-links" class="hidden md:flex items-center gap-3">
                <select id="sort-skills" onchange="renderDashboard(null, 'category', this.value, document.getElementById('search-skills')?.value)" class="p-2 rounded-lg border dark:bg-gray-700 dark:text-white dark:border-gray-600" aria-label="Sort skills">
                    <option value="alphabetical">A-Z</option>
                    <option value="progress">Progress</option>
                    <option value="date">Date Added</option>
                </select>
                <button onclick="openBadgeGallery()" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">Badges</button>
                <button onclick="openFeedback()" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">Feedback</button>
                <button onclick="openHelp()" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">Help</button>
                <button onclick="toggleDarkMode()" id="dark-mode-toggle" class="fas ${darkMode ? 'fa-sun' : 'fa-moon'} text-gray-600 dark:text-gray-300"></button>
            </nav>
        </div>
    </header>

    <nav id="mobile-sidebar" class="fixed inset-y-0 left-0 w-64 bg-white dark:bg-gray-800 shadow-lg transform -translate-x-full transition-transform md:hidden z-50">
        <div class="p-4">
            <button class="text-2xl mb-4" onclick="toggleSidebar()">√ó</button>
            <div class="flex flex-col gap-2">
                <select id="sort-skills-mobile" onchange="renderDashboard(null, 'category', this.value, document.getElementById('search-skills')?.value)" class="p-2 rounded-lg border dark:bg-gray-700 dark:text-white dark:border-gray-600" aria-label="Sort skills">
                    <option value="alphabetical">A-Z</option>
                    <option value="progress">Progress</option>
                    <option value="date">Date Added</option>
                </select>
                <button onclick="openBadgeGallery(); toggleSidebar()" class="text-left text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">Badges</button>
                <button onclick="openFeedback(); toggleSidebar()" class="text-left text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">Feedback</button>
                <button onclick="openHelp(); toggleSidebar()" class="text-left text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">Help</button>
                <button onclick="openStyledModeModal(); toggleSidebar()" class="text-left text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">Unlock Styled Mode</button>
                <button onclick="openLoginModal(); toggleSidebar()" class="text-left text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">Login</button>
                <button onclick="toggleDarkMode(); toggleSidebar()" class="text-left text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100">${darkMode ? '‚òÄÔ∏è Toggle Light Mode' : 'üåô Toggle Dark Mode'}</button>
            </div>
        </div>
    </nav>

    <main id="main-content" class="container mx-auto px-4 py-6 flex-grow"></main>
    
    <button id="fab" class="fixed bottom-4 right-4 bg-blue-600 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg hover:bg-blue-700" aria-label="Add new skill">+</button>
    
    <div id="toast-container" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80 space-y-2"></div>

    <!-- Add Skill Modal -->
    <div id="add-skill-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-xl font-semibold dark:text-white mb-4">Add New Skill</h2>
            <input id="new-skill" type="text" placeholder="Skill name" class="w-full p-2 mb-2 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="New skill name">
            <select id="skill-category" class="w-full p-2 mb-2 rounded-lg border dark:bg-gray-900 dark:text-white">
                <option value="">Select Category</option>
                <option value="Design">Design</option>
                <option value="Speaking">Speaking</option>
            </select>
            <input id="skill-tags" type="text" placeholder="Tags (comma-separated)" class="w-full p-2 mb-4 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Skill tags">
            <div class="flex justify-end gap-2">
                <button onclick="closeAddSkillModal()" class="bg-gray-200 dark:bg-gray-600 px-4 py-2 rounded-lg">Cancel</button>
                <button onclick="addSkill()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Add</button>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 id="onboarding-step-title" class="text-xl font-semibold dark:text-white mb-2"></h2>
            <p id="onboarding-step-desc" class="text-gray-600 dark:text-gray-300 mb-4"></p>
            <div id="onboarding-step-1">
                <input id="onboarding-skill-name" type="text" placeholder="Skill name" class="w-full p-2 mb-4 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Onboarding skill name">
            </div>
            <div id="onboarding-step-2" class="hidden">
                <input id="onboarding-skill-category" type="text" placeholder="Category" class="w-full p-2 mb-2 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Onboarding skill category">
                <input id="onboarding-skill-tags" type="text" placeholder="Tags (comma-separated)" class="w-full p-2 mb-4 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Onboarding skill tags">
            </div>
            <div id="onboarding-step-3" class="hidden">
                <input id="onboarding-milestone-title" type="text" placeholder="Milestone title" class="w-full p-2 mb-2 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Onboarding milestone title">
                <input id="onboarding-milestone-weight" type="number" min="1" max="10" placeholder="Weight (1-10)" class="w-full p-2 mb-2 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Onboarding milestone weight">
                <input id="onboarding-milestone-deadline" type="date" class="w-full p-2 mb-4 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Onboarding milestone deadline">
            </div>
            <div class="flex justify-between">
                <button onclick="skipOnboarding()" class="text-blue-600 dark:text-blue-400 hover:underline">Skip</button>
                <div class="flex gap-2">
                    <button id="onboarding-back-btn" onclick="onboardingPrev()" class="bg-gray-200 dark:bg-gray-600 px-4 py-2 rounded-lg hidden">Back</button>
                    <button onclick="onboardingNext()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Next</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-xl font-semibold dark:text-white mb-4">Share Progress</h2>
            <p id="share-message" class="mb-4 dark:text-white"></p>
            <div class="flex flex-wrap gap-2">
                <button onclick="shareTo('twitter')" class="bg-blue-400 text-white px-3 py-2 rounded-lg hover:bg-blue-500">X (Twitter)</button>
                <button onclick="shareTo('facebook')" class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700">Facebook</button>
                <button onclick="shareTo('linkedin')" class="bg-blue-800 text-white px-3 py-2 rounded-lg hover:bg-blue-900">LinkedIn</button>
                <button onclick="copyShareLink()" class="bg-gray-200 dark:bg-gray-600 px-3 py-2 rounded-lg">Copy Link</button>
                <button onclick="downloadCardImage()" class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700">Download Card</button>
            </div>
            <button onclick="closeShareModal()" class="mt-4 text-blue-600 dark:text-blue-400 hover:underline">Cancel</button>
        </div>
    </div>

    <!-- Edit Skill Modal -->
    <div id="edit-skill-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-xl font-semibold dark:text-white mb-4">Edit Skill</h2>
            <input id="edit-skill-name" type="text" placeholder="Skill name" class="w-full p-2 mb-2 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Edit skill name">
            <input id="edit-skill-category" type="text" placeholder="Category" class="w-full p-2 mb-2 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Edit skill category">
            <input id="edit-skill-tags" type="text" placeholder="Tags (comma-separated)" class="w-full p-2 mb-4 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Edit skill tags">
            <div class="flex justify-end gap-2">
                <button onclick="closeEditSkillModal()" class="bg-gray-200 dark:bg-gray-600 px-4 py-2 rounded-lg">Cancel</button>
                <button onclick="saveEditedSkill()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Save</button>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-xl font-semibold dark:text-white mb-4">Feedback</h2>
            <textarea id="feedback-text" class="w-full h-32 p-2 rounded-lg border dark:bg-gray-900 dark:text-white" placeholder="Your feedback..." aria-label="Feedback text"></textarea>
            <div class="flex justify-end gap-2 mt-4">
                <button onclick="submitFeedback()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Submit</button>
                <button onclick="closeFeedback()" class="bg-gray-200 dark:bg-gray-600 px-4 py-2 rounded-lg">Close</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-xl font-semibold dark:text-white mb-4">How to Use Momentum</h2>
            <ul class="list-disc pl-5 text-gray-600 dark:text-gray-300 mb-4">
                <li>Add skills using the "+ Add Skill" button.</li>
                <li>View and update milestones, practice history, and reflections.</li>
                <li>Track your progress visually with charts and heatmaps.</li>
                <li>Export your progress as PNG, PDF, JSON, or CSV.</li>
                <li>Maintain streaks by practicing daily.</li>
                <li>Unlock Styled to Sell Mode for enhanced features.</li>
            </ul>
            <button onclick="closeHelp()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Close</button>
        </div>
    </div>

    <!-- Badge Gallery Modal -->
    <div id="badge-gallery-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full max-w-2xl">
            <h2 class="text-xl font-semibold dark:text-white mb-4">üèÖ Badge Gallery</h2>
            <div id="badge-gallery-content" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            <button onclick="closeBadgeGallery()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Close</button>
        </div>
    </div>

    <!-- Styled Mode Unlock Modal -->
    <div id="styled-mode-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-xl font-semibold dark:text-white mb-4">Unlock Styled to Sell Mode</h2>
            <input id="styled-mode-code" type="text" placeholder="Enter code (e.g., SELLSTYLE23)" class="w-full p-2 mb-4 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Styled mode code">
            <div class="flex justify-end gap-2">
                <button onclick="closeStyledModeModal()" class="bg-gray-200 dark:bg-gray-600 px-4 py-2 rounded-lg">Cancel</button>
                <button onclick="unlockStyledMode()" class="bg-pink-500 text-white px-4 py-2 rounded-lg hover:bg-pink-600">Unlock</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-xl font-semibold dark:text-white mb-4">Login to Sync Data</h2>
            <input id="login-email" type="email" placeholder="Email" class="w-full p-2 mb-2 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Login email">
            <input id="login-password" type="password" placeholder="Password (optional)" class="w-full p-2 mb-4 rounded-lg border dark:bg-gray-900 dark:text-white" aria-label="Login password">
            <div class="flex justify-end gap-2">
                <button onclick="loginWithEmail(document.getElementById('login-email').value, document.getElementById('login-password').value)" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Login</button>
                <button onclick="loginWithMagicLink(document.getElementById('login-email').value)" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Magic Link</button>
                <button onclick="closeLoginModal()" class="bg-gray-200 dark:bg-gray-600 px-4 py-2 rounded-lg">Cancel</button>
            </div>
        </div>
    </div>

    <footer class="bg-white dark:bg-gray-800 py-4 mt-auto">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-600 dark:text-gray-300">¬© 2025 Momentum. All rights reserved.</p>
            <div class="flex justify-center gap-4 mt-2">
                <a href="https://twitter.com" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100"><i class="fab fa-twitter"></i></a>
                <a href="https://facebook.com" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100"><i class="fab fa-facebook"></i></a>
                <a href="https://linkedin.com" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100"><i class="fab fa-linkedin"></i></a>
            </div>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Designed with ‚ù§ by Elora</p>
        </div>
    </footer>
</body>
</html>